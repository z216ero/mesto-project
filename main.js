(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{N:()=>_});var t;function n(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.buttonInactive),n.disabled=!1):(n.classList.add(e.buttonInactive),n.disabled=!0)}function o(e){t=null,e.classList.remove("popup_opened"),e.removeEventListener("click",u),document.removeEventListener("keydown",c)}function r(e){t=e,e.classList.add("popup_opened"),e.addEventListener("click",u),document.addEventListener("keydown",c)}function c(e){"Escape"===e.code&&o(t)}function u(e){e.target.classList.contains("popup")&&o(t)}var a="https://nomoreparties.co/v1/plus-cohort-12/",i="c4197417-e087-4a59-83a9-426a682aed65",l="application/json",s=document.querySelector("#element-template").content,d=document.querySelector(".elements"),p=document.querySelector(".photo-popup"),f=p.querySelector(".photo-popup__name"),m=p.querySelector(".photo-popup__photo");function v(e){d.prepend(e)}function h(e,t,n,o,c){var u=s.querySelector(".element").cloneNode(!0),l=u.querySelector(".element__photo"),d=u.querySelector(".element__like-count");l.src=t,l.alt=e,d.textContent=n.length,u.querySelector(".element__name").textContent=e;var v=u.querySelector(".element__like-button"),h=u.querySelector(".element__delete-button");return o===_.id?h.addEventListener("click",(function(){u.remove(),function(e){return console.log(e),fetch("".concat(a,"cards/").concat(e),{method:"DELETE",headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c).catch((function(e){return console.log(e)}))})):h.remove(),n.some((function(e){return e._id===_.id}))&&v.classList.add("element_liked"),v.addEventListener("click",(function(e){e.target.classList.toggle("element_liked"),e.target.classList.contains("element_liked")?function(e){return console.log(e),fetch("".concat(a,"cards/likes/").concat(e),{method:"PUT",headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c).then((function(e){return d.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return console.log(e),fetch("".concat(a,"cards/likes/").concat(e),{method:"DELETE",headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c).then((function(e){return d.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),l.addEventListener("click",(function(){return function(e,t){f.textContent=e,m.src=t,m.alt=e,r(p)}(e,t)})),u}var _={name:"",about:"",id:0,avatar:""},y=document.querySelectorAll(".popup"),S=document.querySelector(".profile-popup"),b=document.querySelector(".card-popup"),E=document.querySelector(".avatar-popup"),L=document.querySelector(".profile__avatar-wrapper"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button");y.forEach((function(e){e.querySelector(".popup__close-button").addEventListener("click",(function(){return o(e)}))}));var g,C=document.forms.profile,j=C.elements.name,x=C.elements.role,P=document.forms.card,A=P.elements.title,T=P.elements.src,I=document.forms.avatar,z=I.elements.src,O=document.querySelector(".profile__name"),D=document.querySelector(".profile__role"),w=document.querySelector(".profile__avatar");function N(){fetch("".concat(a,"users/me"),{headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){_.name=e.name,_.about=e.about,_.id=e._id,_.avatar=e.avatar,O.textContent=e.name,D.textContent=e.about,w.src=e.avatar})).catch((function(e){console.log(e)}))}g={formSelector:".popup__form",inputSelector:".popup__input",popupSaveButtonSelector:".popup__save-button",popupFieldsetSelector:".popup__fieldset",popupInputTypeError:"popup__input_type_error",buttonInactive:"button_inactive",formInputErrorActive:"form__input-error_active"},Array.from(document.querySelectorAll(g.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(g.popupFieldsetSelector)).forEach((function(e){!function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.popupSaveButtonSelector);n(e,o,r),o.forEach((function(c){c.addEventListener("input",(function(){n(e,o,r),function(e,t,n){n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.popupInputTypeError),o.classList.remove(e.formInputErrorActive),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.popupInputTypeError),r.textContent=o,r.classList.add(e.formInputErrorActive)}(e,t,n,n.validationMessage)}(e,t,c)}))}))}(g,e)}))})),fetch("".concat(a,"cards"),{headers:{authorization:i}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){v(h(e.name,e.link,e.likes,e.owner._id,e._id))}))})).catch((function(e){console.log(e)})),N(),k.addEventListener("click",(function(){j.value=_.name,x.value=_.about,r(S)})),q.addEventListener("click",(function(){r(b)})),L.addEventListener("click",(function(){r(E)})),C.addEventListener("submit",(function(e){var t,n,r=C.querySelector(".popup__save-button");r.textContent="Сохранение...",e.preventDefault(),(t=j.value,n=x.value,fetch("".concat(a,"users/me"),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return N()})).finally((function(e){return r.textContent="Сохранить"})).catch((function(e){return console.log(e)})),o(S)})),P.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=P.querySelector(".popup__save-button");r.textContent="Сохранение...",(t=A.value,n=T.value,fetch("".concat(a,"cards"),{method:"POST",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){v(h(A.value,T.value,[],_.id,e._id)),o(b),P.reset(),r.disabled=!0,r.classList.add("button_inactive")})).finally((function(e){return r.textContent="Создать"})).catch((function(e){return console.log(e)}))})),I.addEventListener("submit",(function(e){var t,n=I.querySelector(".popup__save-button");n.textContent="Сохранение...",e.preventDefault(),(t=z.value,fetch("".concat(a,"users/me/avatar"),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return N()})).finally((function(e){return n.textContent="Сохранить"})).catch((function(e){return console.log(e)})),o(E),I.reset(),n.disabled=!0,n.classList.add("button_inactive")}))})();