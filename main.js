(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{N:()=>b});var t;function n(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.buttonInactive),n.disabled=!1):(n.classList.add(e.buttonInactive),n.disabled=!0)}function o(e){t=null,e.classList.remove("popup_opened"),e.removeEventListener("click",a),document.removeEventListener("keydown",c)}function r(e){t=e,e.classList.add("popup_opened"),e.addEventListener("click",a),document.addEventListener("keydown",c)}function c(e){"Escape"===e.code&&o(t)}function a(e){e.target.classList.contains("popup")&&o(t)}var u="https://nomoreparties.co/v1/plus-cohort-12/",i="c4197417-e087-4a59-83a9-426a682aed65",l="application/json",s=function(){return fetch("".concat(u,"users/me"),{headers:{authorization:i}}).then(d)};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var p=document.querySelector("#element-template").content,f=document.querySelector(".elements"),m=document.querySelector(".photo-popup"),v=m.querySelector(".photo-popup__name"),h=m.querySelector(".photo-popup__photo");function y(e){f.prepend(e)}function _(e,t,n,o,c){var a=p.querySelector(".element").cloneNode(!0),l=a.querySelector(".element__photo"),s=a.querySelector(".element__like-count");l.src=t,l.alt=e,s.textContent=n.length,a.querySelector(".element__name").textContent=e;var f=a.querySelector(".element__like-button"),y=a.querySelector(".element__delete-button");return o===b.id?y.addEventListener("click",(function(){(function(e){return console.log(e),fetch("".concat(u,"cards/").concat(e),{method:"DELETE",headers:{authorization:i}}).then(d)})(c).then((function(e){return a.remove()})).catch((function(e){return console.log(e)}))})):y.remove(),n.some((function(e){return e._id===b.id}))&&f.classList.add("element_liked"),f.addEventListener("click",(function(e){e.target.classList.contains("element_liked")?function(e){return console.log(e),fetch("".concat(u,"cards/likes/").concat(e),{method:"PUT",headers:{authorization:i}}).then(d)}(c).then((function(t){s.textContent=t.likes.length,e.target.classList.add("element_liked")})).catch((function(e){return console.log(e)})):function(e){return console.log(e),fetch("".concat(u,"cards/likes/").concat(e),{method:"DELETE",headers:{authorization:i}}).then(d)}(c).then((function(t){s.textContent=t.likes.length,e.target.classList.remove("element_liked")})).catch((function(e){return console.log(e)}))})),l.addEventListener("click",(function(){return function(e,t){v.textContent=e,h.src=t,h.alt=e,r(m)}(e,t)})),a}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var b={name:"",about:"",id:0,avatar:""},E=document.querySelectorAll(".popup"),L=document.querySelector(".profile-popup"),q=document.querySelector(".card-popup"),g=document.querySelector(".avatar-popup"),k=document.querySelector(".profile__avatar-wrapper"),C=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button");E.forEach((function(e){e.querySelector(".popup__close-button").addEventListener("click",(function(){return o(e)}))}));var A,T=document.forms.profile,I=T.elements.name,w=T.elements.role,O=T.querySelector(".popup__save-button"),j=document.forms.card,z=j.elements.title,P=j.elements.src,D=j.querySelector(".popup__save-button"),N=document.forms.avatar,J=N.elements.src,B=N.querySelector(".popup__save-button"),F=document.querySelector(".profile__name"),H=document.querySelector(".profile__role"),M=document.querySelector(".profile__avatar");function U(){s().then((function(e){b.name=e.name,b.about=e.about,b.id=e._id,b.avatar=e.avatar,F.textContent=e.name,H.textContent=e.about,M.src=e.avatar})).catch((function(e){console.log(e)}))}A={formSelector:".popup__form",inputSelector:".popup__input",popupSaveButtonSelector:".popup__save-button",popupFieldsetSelector:".popup__fieldset",popupInputTypeError:"popup__input_type_error",buttonInactive:"button_inactive",formInputErrorActive:"form__input-error_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(A.popupFieldsetSelector)).forEach((function(e){!function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.popupSaveButtonSelector);n(e,o,r),o.forEach((function(c){c.addEventListener("input",(function(){n(e,o,r),function(e,t,n){n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.popupInputTypeError),o.classList.remove(e.formInputErrorActive),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.popupInputTypeError),r.textContent=o,r.classList.add(e.formInputErrorActive)}(e,t,n,n.validationMessage)}(e,t,c)}))}))}(A,e)}))})),Promise.all([s(),fetch("".concat(u,"cards"),{headers:{authorization:i}}).then(d)]).then((function(e){var t,n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);a=!0);}catch(e){u=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw r}}return c}}(n,o)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];t=c,b.name=t.name,b.about=t.about,b.id=t._id,b.avatar=t.avatar,F.textContent=t.name,H.textContent=t.about,M.src=t.avatar,function(e){e.forEach((function(e){y(_(e.name,e.link,e.likes,e.owner._id,e._id))}))}(a)})).catch((function(e){console.log(e)})),C.addEventListener("click",(function(){I.value=b.name,w.value=b.about,r(L)})),x.addEventListener("click",(function(){r(q)})),k.addEventListener("click",(function(){r(g)})),T.addEventListener("submit",(function(e){var t,n;O.textContent="Сохранение...",e.preventDefault(),(t=I.value,n=w.value,fetch("".concat(u,"users/me"),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:t,about:n})}).then(d)).then((function(e){U(),o(L)})).finally((function(e){return O.textContent="Сохранить"})).catch((function(e){return console.log(e)}))})),j.addEventListener("submit",(function(e){var t,n;e.preventDefault(),D.textContent="Сохранение...",(t=z.value,n=P.value,fetch("".concat(u,"cards"),{method:"POST",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({name:t,link:n})}).then(d)).then((function(e){y(_(z.value,P.value,[],b.id,e._id)),o(q),j.reset(),D.disabled=!0,D.classList.add("button_inactive")})).finally((function(e){return D.textContent="Создать"})).catch((function(e){return console.log(e)}))})),N.addEventListener("submit",(function(e){var t;B.textContent="Сохранение...",e.preventDefault(),(t=J.value,fetch("".concat(u,"users/me/avatar"),{method:"PATCH",headers:{authorization:i,"Content-Type":l},body:JSON.stringify({avatar:t})}).then(d)).then((function(e){U(),o(g),N.reset(),B.disabled=!0,B.classList.add("button_inactive")})).finally((function(e){return B.textContent="Сохранить"})).catch((function(e){return console.log(e)}))}))})();